{
  "hash": "178337fc75c33a1437bdc6bf5ea401d4",
  "result": {
    "engine": "knitr",
    "markdown": "# Esplorare i dati qualitativi {#sec-eda-qualitative-data}\n\n::: callout-note\n## In questo capitolo imparerai a\n\n- calcolare proporzioni e tabelle di contingenza\n- costruire grafici a barre\n:::\n\n::: callout-tip\n## Prerequisiti\n\n- Leggere il capitolo [Exploring categorical data](https://openintro-ims.netlify.app/explore-categorical) di [Introduction to Modern Statistics (2e)](https://openintro-ims.netlify.app) di Mine Çetinkaya-Rundel e Johanna Hardin.\n:::\n\n::: callout-important\n## Preparazione del Notebook\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhere::here(\"code\", \"_common.R\") |> \n  source()\n\n# Load packages\nif (!requireNamespace(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(tidyr, viridis, vcd)\n```\n:::\n\n\n\n:::\n\n## Introduzione\n\nIn questo capitolo ci concentreremo sull'analisi dei dati qualitativi.\n\n## Il dataset `penguins`\n\nPer fornire esempi pratici, in questo capitolo utilizzeremo il dataset [palmerpenguins](https://allisonhorst.github.io/palmerpenguins/index.html), messo a disposizione da [Allison Horst](https://allisonhorst.com). I dati sono stati raccolti e resi disponibili da [Dr. Kristen Gorman](https://www.uaf.edu/cfos/people/faculty/detail/kristen-gorman.php) e dalla Palmer Station, parte del programma di ricerca ecologica a lungo termine [Long Term Ecological Research Network](https://lternet.edu). Il dataset contiene informazioni su 344 pinguini, appartenenti a 3 diverse specie, raccolte su 3 isole dell'arcipelago di Palmer, in Antartide. Per semplicità, i dati sono organizzati nel file `penguins.csv`.\n\n## Importare i Dati\n\nPossiamo caricare i dati grezzi dal file `penguins.csv` in un DataFrame con il seguente comando:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- rio::import(here::here(\"data\", \"penguins.csv\"))\n```\n:::\n\n\n\n\nEsaminiamo i dati.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(d)\n#> Rows: 344\n#> Columns: 8\n#> $ species           <chr> \"Adelie\", \"Adelie\", \"Adelie\", \"Adelie\", \"Adelie\",…\n#> $ island            <chr> \"Torgersen\", \"Torgersen\", \"Torgersen\", \"Torgersen…\n#> $ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.…\n#> $ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.…\n#> $ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, …\n#> $ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 347…\n#> $ sex               <chr> \"male\", \"female\", \"female\", NA, \"female\", \"male\",…\n#> $ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2…\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nd |> \n  head()\n#>   species    island bill_length_mm bill_depth_mm flipper_length_mm\n#> 1  Adelie Torgersen           39.1          18.7               181\n#> 2  Adelie Torgersen           39.5          17.4               186\n#> 3  Adelie Torgersen           40.3          18.0               195\n#> 4  Adelie Torgersen             NA            NA                NA\n#> 5  Adelie Torgersen           36.7          19.3               193\n#> 6  Adelie Torgersen           39.3          20.6               190\n#>   body_mass_g    sex year\n#> 1        3750   male 2007\n#> 2        3800 female 2007\n#> 3        3250 female 2007\n#> 4          NA   <NA> 2007\n#> 5        3450 female 2007\n#> 6        3650   male 2007\n```\n:::\n\n\n\n\nPer semplicità, rimuoviamo le righe con valori mancanti con la seguente istruzione:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- d |>\n  drop_na()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf |> \n  summary()\n#>    species             island          bill_length_mm bill_depth_mm \n#>  Length:333         Length:333         Min.   :32.1   Min.   :13.1  \n#>  Class :character   Class :character   1st Qu.:39.5   1st Qu.:15.6  \n#>  Mode  :character   Mode  :character   Median :44.5   Median :17.3  \n#>                                        Mean   :44.0   Mean   :17.2  \n#>                                        3rd Qu.:48.6   3rd Qu.:18.7  \n#>                                        Max.   :59.6   Max.   :21.5  \n#>  flipper_length_mm  body_mass_g       sex                 year     \n#>  Min.   :172       Min.   :2700   Length:333         Min.   :2007  \n#>  1st Qu.:190       1st Qu.:3550   Class :character   1st Qu.:2007  \n#>  Median :197       Median :4050   Mode  :character   Median :2008  \n#>  Mean   :201       Mean   :4207                      Mean   :2008  \n#>  3rd Qu.:213       3rd Qu.:4775                      3rd Qu.:2009  \n#>  Max.   :231       Max.   :6300                      Max.   :2009\n```\n:::\n\n\n\n\n## Tabelle di Contingenza\n\nUna *tabella di contingenza* è uno strumento utilizzato per riassumere i dati di due variabili categoriali, ovvero variabili qualitative che assumono valori all'interno di un insieme finito di categorie. In una tabella di contingenza, ogni cella mostra quante volte si è verificata una combinazione specifica di categorie per le due variabili considerate.\n\nPer esempio, se prendiamo in esame due variabili categoriali come \"island\" e \"species\" all'interno di un DataFrame `df`, ciascuna delle quali rappresenta rispettivamente l'isola di provenienza e la specie dei pinguini, possiamo costruire una tabella che mostra quante volte ciascuna combinazione di \"island\" e \"species\" appare nel nostro campione. In altre parole, la tabella di contingenza ci permette di vedere quante osservazioni ci sono per ogni combinazione di categorie tra queste due variabili.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(df$island, df$species)\n#>            \n#>             Adelie Chinstrap Gentoo\n#>   Biscoe        44         0    119\n#>   Dream         55        68      0\n#>   Torgersen     47         0      0\n```\n:::\n\n\n\n\nQuesta tabella di contingenza mostra la distribuzione di tre specie di pinguini (Adelie, Chinstrap, Gentoo) rispetto a tre isole (Biscoe, Dream, Torgersen). Ogni cella rappresenta il numero di pinguini di una determinata specie presenti su ciascuna isola. Ecco un'interpretazione dettagliata:\n\n- **Isola Biscoe**: Qui troviamo 44 pinguini della specie Adelie e 119 pinguini della specie Gentoo, mentre non sono presenti pinguini Chinstrap.\n- **Isola Dream**: Questa isola ospita 55 pinguini Adelie e 68 pinguini Chinstrap, ma nessun pinguino della specie Gentoo.\n- **Isola Torgersen**: Su quest'isola sono presenti solo 47 pinguini della specie Adelie, e nessun pinguino delle specie Chinstrap o Gentoo.\n\nPossiamo dunque commentare dicendo: \n\n1. La specie **Adelie** è distribuita su tutte e tre le isole, con numeri notevoli sia su Biscoe (44), Dream (55), che Torgersen (47).\n2. La specie **Chinstrap** si trova solo sull'isola Dream (68 esemplari) e non è presente sulle altre due isole.\n3. La specie **Gentoo** si trova esclusivamente sull'isola Biscoe (119 esemplari), non essendo presente su Dream e Torgersen.\n\nQuesto suggerisce una distribuzione geografica specifica delle diverse specie di pinguini, con alcune specie limitate a determinate isole e altre distribuite più ampiamente.\n\n## Grafico a barre\n\n### Grafico a Barre con una Singola Variabile\n\nUn grafico a barre è uno strumento comunemente utilizzato per rappresentare visivamente una singola variabile categoriale. Questo tipo di grafico mostra le diverse categorie su uno degli assi (solitamente l'asse orizzontale) e utilizza barre di altezza proporzionale per rappresentare la frequenza o il conteggio di ciascuna categoria sull'altro asse (solitamente l'asse verticale).\n\nAd esempio, in un dataset che contiene informazioni su diverse specie di pinguini, un grafico a barre potrebbe mostrare il numero di pinguini per ciascuna specie. Le specie vengono visualizzate come etichette lungo l'asse delle ascisse, mentre l'altezza delle barre rappresenta il numero di pinguini osservati per ciascuna specie. \n\nIl grafico a barre consente di confrontare le dimensioni delle categorie in modo semplice e intuitivo.\n\nPer i dati in esame, creiamo un grafico a barre che rappresenta il numero totale di pinguini per isola.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = island)) +\n  geom_bar(alpha = 0.5) +\n  ggtitle(\"Numero totale di pinguini per isola\") +\n  xlab(\"Isola\") +\n  ylab(\"Numero di pinguini\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-8-1.png){width=576}\n:::\n:::\n\n\n\n\nUn secondo grafico a barre mostra il numero totale di pinguini per specie.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = species)) +\n  geom_bar(alpha = 0.5) +\n  ggtitle(\"Numero totale di pinguini per specie\") +\n  xlab(\"Specie\") +\n  ylab(\"Numero di pinguini\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-9-1.png){width=576}\n:::\n:::\n\n\n\n\n### Grafico a Barre con Due Variabili\n\nÈ possibile visualizzare contemporaneamente le distribuzioni di due variabili categoriali utilizzando un grafico a barre. Questo tipo di grafico è particolarmente utile per esaminare la relazione tra due variabili categoriali.\n\nIn un grafico a barre con due variabili, una delle variabili viene rappresentata sull'asse orizzontale come categoria principale, mentre la seconda variabile è distinta tramite colori diversi o barre impilate. In questo modo, possiamo confrontare facilmente le frequenze o le proporzioni delle categorie della prima variabile, osservando allo stesso tempo come sono distribuite le categorie della seconda variabile all'interno di ciascuna categoria principale.\n\nAd esempio, visualizziamo il numero di pinguini per specie e isola. A qusto fine possiamo creare un grafico a barre dove le isole sono rappresentate sull'asse delle ascisse e i diversi colori delle barre mostrano la distribuzione delle specie su ciascuna isola. Questo approccio consente di esplorare come le due variabili categoriali (specie e isola) interagiscono visivamente.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = island, fill = species)) +\n  geom_bar(position = \"stack\") +\n  ggtitle(\"Numero di pinguini per specie e isola\") +\n  xlab(\"Isola\") +\n  ylab(\"Numero di pinguini\") +\n  labs(fill = \"Specie\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-10-1.png){width=576}\n:::\n:::\n\n\n\n\nIn alternativa, è possibile creare un grafico a barre dove le specie sono rappresentate sull'asse delle ascisse e i diversi colori delle barre mostrano la distribuzione delle isole per ciascuna specie. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = species, fill = island)) +\n  geom_bar(position = \"stack\") +\n  ggtitle(\"Numero di pinguini per isola e specie\") +\n  xlab(\"Specie\") +\n  ylab(\"Numero di pinguini\") +\n  labs(fill = \"Isola\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-11-1.png){width=576}\n:::\n:::\n\n\n\n\nIn alternativa all'uso delle frequenze assolute, possiamo rappresentare i dati utilizzando le frequenze relative. Questo approccio permette di confrontare meglio le categorie indipendentemente dal numero totale di osservazioni. Nella figura seguente, ad esempio, viene mostrata la proporzione di pinguini di ciascuna specie per ogni isola, evidenziando la distribuzione relativa delle specie su ogni isola, anziché il conteggio assoluto. Questa rappresentazione aiuta a visualizzare le differenze nella composizione delle specie, anche se il numero complessivo di pinguini varia tra le isole.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = island, fill = species)) +\n  geom_bar(position = \"fill\") +\n  ggtitle(\"Proporzione di pinguini per specie e isola\") +\n  xlab(\"Isola\") +\n  ylab(\"Proporzione\") +\n  labs(fill = \"Specie\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-12-1.png){width=576}\n:::\n:::\n\n\n\n\n## Mosaic plots\n\nIl *Mosaic plot* è una tecnica di visualizzazione particolarmente adatta per rappresentare tabelle di contingenza. Questo tipo di grafico somiglia a un grafico a barre impilate standard, ma con un vantaggio importante: oltre a visualizzare la suddivisione interna delle categorie, permette di vedere anche le dimensioni relative dei gruppi della variabile principale.\n\nIn altre parole, il Mosaic plot non solo mostra come si distribuiscono le categorie di una variabile secondaria all'interno di ogni gruppo della variabile principale, ma fornisce anche un'idea visiva della grandezza complessiva dei gruppi. Questo lo rende uno strumento utile per analizzare e interpretare le relazioni tra due variabili categoriali, evidenziando sia la proporzione all'interno di ciascun gruppo, sia la grandezza relativa tra i gruppi stessi.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmosaic(~ species + island, data = df, main = \"Mosaic Plot of Species and Island\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-13-1.png){width=576}\n:::\n:::\n\n\n\n\n## Proporzioni di Riga e Colonna\n\nNelle sezioni precedenti abbiamo esaminato la visualizzazione di due variabili categoriali utilizzando grafici a barre e Mosaic plot. Tuttavia, non abbiamo ancora discusso come vengono calcolate le proporzioni mostrate in questi grafici. In questa sezione ci concentreremo sulla suddivisione frazionaria di una variabile rispetto a un'altra, esplorando come possiamo modificare la nostra tabella di contingenza per ottenere una visione più dettagliata delle proporzioni.\n\nQuesto ci permetterà di comprendere meglio le relazioni tra le due variabili, visualizzando non solo i conteggi assoluti, ma anche le proporzioni relative per riga o per colonna. Le proporzioni di riga mostrano la distribuzione di una variabile all'interno delle categorie di un'altra, mentre le proporzioni di colonna evidenziano la distribuzione inversa.\n\nCalcoliamo le proporzioni di specie per isola.        \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcola le proporzioni di riga\nrow_proportions <- df |> \n  count(island, species) |> \n  group_by(island) |> \n  mutate(proportion = n / sum(n)) |> \n  pivot_wider(names_from = species, values_from = proportion, values_fill = 0)\n\n# Aggiungi una colonna \"Totale\" che rappresenta il totale di ciascuna riga\nrow_proportions_with_total <- row_proportions |> \n  mutate(Totale = rowSums(across(where(is.numeric))))\n\n# Mostra la tabella con proporzioni di riga e il totale\nprint(row_proportions_with_total)\n#> # A tibble: 5 × 6\n#> # Groups:   island [3]\n#>   island        n Adelie Gentoo Chinstrap Totale\n#>   <chr>     <int>  <dbl>  <dbl>     <dbl>  <dbl>\n#> 1 Biscoe       44  0.270  0         0       44.3\n#> 2 Biscoe      119  0      0.730     0      120. \n#> 3 Dream        55  0.447  0         0       55.4\n#> 4 Dream        68  0      0         0.553   68.6\n#> 5 Torgersen    47  1      0         0       48\n```\n:::\n\n\n\n\nCalcoliamo nuovamente le proporzioni, ma questa volta in funzione delle colonne (per isola).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calcola la tabella di contingenza\ncontingency_table <- xtabs(~ island + species, data = df)\n\n# Calcola le proporzioni di colonna\ncolumn_proportions <- prop.table(contingency_table, margin = 2)\n\n# Aggiungi una riga \"Totale\" con la somma di ciascuna colonna\ncolumn_proportions_with_total <- rbind(\n  column_proportions, Totale = colSums(column_proportions)\n)\n\n# Mostra la tabella con proporzioni di colonna e il totale\nprint(column_proportions_with_total)\n#>           Adelie Chinstrap Gentoo\n#> Biscoe     0.301         0      1\n#> Dream      0.377         1      0\n#> Torgersen  0.322         0      0\n#> Totale     1.000         1      1\n```\n:::\n\n\n\n\n## Confronto tra Gruppi\n\nAlcune delle analisi più interessanti emergono confrontando i dati numerici tra diversi gruppi. In questa sezione approfondiremo alcune delle tecniche che abbiamo già esplorato per visualizzare i dati numerici di più gruppi su uno stesso grafico e introdurremo nuovi metodi per confrontare i dati numerici tra gruppi. Queste tecniche ci permetteranno di osservare meglio le differenze e le somiglianze tra gruppi, mettendo in evidenza tendenze, variazioni e altre caratteristiche rilevanti.\n\nQui consideriamo due variabili qualitative. Creiamo un grafico a barre per confrontare la distribuzione del genere per specie.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = species, fill = sex)) +\n  geom_bar(position = \"dodge\") +\n  ggtitle(\"Distribuzione del genere per specie\") +\n  xlab(\"Specie\") +\n  ylab(\"Conteggio\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-16-1.png){width=576}\n:::\n:::\n\n\n\n\nSpesso, i confronti più interessanti riguardano come una variabile numerica varia in base a una o più categorie. Questo tipo di analisi ci aiuta a capire differenze tra gruppi e a individuare modelli o tendenze.\n\nNel grafico seguente, confrontiamo la distribuzione del peso corporeo (`body_mass_g`) in base alla specie e al genere. Le aree colorate rappresentano come si distribuisce il peso per maschi e femmine all'interno di ciascuna specie. Le linee più strette al centro delle aree colorate aggiungono ulteriori dettagli, mostrando i valori più comuni e come si concentrano i dati per ciascun gruppo.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df, aes(x = species, y = body_mass_g, fill = sex)) +\n  geom_violin(position = position_dodge(width = 0.9), alpha = 0.5) +\n  geom_boxplot(position = position_dodge(width = 0.9), width = 0.2, alpha = 0.8) +\n  ggtitle(\"Distribuzione della massa corporea\\nin base alla specie e al genere\") +\n  xlab(\"Specie\") +\n  ylab(\"Massa corporea (g)\") +\n  labs(fill = \"Genere\")\n```\n\n::: {.cell-output-display}\n![](04_exploring_qualitative_data_files/figure-html/unnamed-chunk-17-1.png){width=576}\n:::\n:::\n\n\n\n\n1. **Aree colorate (grafico a violino)**:\n   - Rappresentano l'intera distribuzione dei pesi per ogni gruppo (specie e genere). Più l'area è larga in un punto, maggiore è il numero di pinguini con quel peso.\n\n2. **Linee strette al centro (boxplot)**:\n   - Forniscono un riassunto visivo dei dati, mostrando dove i pesi si concentrano maggiormente e quanto variano all'interno di ciascun gruppo.\n\n3. **Cosa possiamo osservare**:\n   - Possiamo vedere facilmente se i maschi e le femmine di una stessa specie tendono ad avere pesi simili o differenti, e se c'è una certa sovrapposizione tra i due gruppi.\n\n## Informazioni sull'Ambiente di Sviluppo {.unnumbered} \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n#> R version 4.4.2 (2024-10-31)\n#> Platform: aarch64-apple-darwin20\n#> Running under: macOS Sequoia 15.2\n#> \n#> Matrix products: default\n#> BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \n#> LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n#> \n#> locale:\n#> [1] C/UTF-8/C/C/C/C\n#> \n#> time zone: Europe/Rome\n#> tzcode source: internal\n#> \n#> attached base packages:\n#> [1] grid      stats     graphics  grDevices utils     datasets  methods  \n#> [8] base     \n#> \n#> other attached packages:\n#>  [1] vcd_1.4-13        viridis_0.6.5     viridisLite_0.4.2 gridExtra_2.3    \n#>  [5] patchwork_1.3.0   bayesplot_1.11.1  psych_2.4.6.26    scales_1.3.0     \n#>  [9] markdown_1.13     knitr_1.49        lubridate_1.9.4   forcats_1.0.0    \n#> [13] stringr_1.5.1     dplyr_1.1.4       purrr_1.0.2       readr_2.1.5      \n#> [17] tidyr_1.3.1       tibble_3.2.1      ggplot2_3.5.1     tidyverse_2.0.0  \n#> [21] rio_1.2.3         here_1.0.1       \n#> \n#> loaded via a namespace (and not attached):\n#>  [1] utf8_1.2.4        generics_0.1.3    stringi_1.8.4     lattice_0.22-6   \n#>  [5] hms_1.1.3         digest_0.6.37     magrittr_2.0.3    evaluate_1.0.1   \n#>  [9] timechange_0.3.0  fastmap_1.2.0     R.oo_1.27.0       rprojroot_2.0.4  \n#> [13] jsonlite_1.8.9    R.utils_2.12.3    fansi_1.0.6       mnormt_2.1.1     \n#> [17] cli_3.6.3         rlang_1.1.4       R.methodsS3_1.8.2 munsell_0.5.1    \n#> [21] withr_3.0.2       tools_4.4.2       parallel_4.4.2    tzdb_0.4.0       \n#> [25] colorspace_2.1-1  pacman_0.5.1      vctrs_0.6.5       R6_2.5.1         \n#> [29] zoo_1.8-12        lifecycle_1.0.4   htmlwidgets_1.6.4 MASS_7.3-61      \n#> [33] pkgconfig_2.0.3   pillar_1.9.0      gtable_0.3.6      data.table_1.16.4\n#> [37] glue_1.8.0        lmtest_0.9-40     xfun_0.49         tidyselect_1.2.1 \n#> [41] farver_2.1.2      htmltools_0.5.8.1 nlme_3.1-166      labeling_0.4.3   \n#> [45] rmarkdown_2.29    compiler_4.4.2\n```\n:::\n",
    "supporting": [
      "04_exploring_qualitative_data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}